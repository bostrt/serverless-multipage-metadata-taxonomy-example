<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<title>Eventing</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<style>.toc-current{font-weight: bold;} .toc-root{font-family: "Open Sans","DejaVu Sans",sans-serif;
                       font-size: 0.9em;} #content{display: flex; flex-direction: column; flex: 1 1 auto;}
             .nav-footer{text-align: center; margin-top: auto;}
             .nav-footer > p > a {white-space: nowrap;}</style>
</head>
<body id="_brokers" class="book toc2 toc-left">
<div id="header">
<h1>Eventing</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<p><span class="toc-root"><a href="master.html">Eventing</a></span></p><ul class="sectlevel1">
<li><a href="knative-eventing-overview.html">1. Knative Eventing</a>
</li>
<li><a href="_event-sources.html">2. Event sources</a>
</li>
<li><a href="_event-sinks.html">3. Event sinks</a>
</li>
<li><a href="_brokers.html"><span class="toc-current">4. Brokers</span></a>
<ul class="sectlevel2">
<li><a href="_brokers.html#serverless-brokers">4.1. Brokers</a>
</li>
<li><a href="_brokers.html#serverless-broker-types">4.2. Broker types</a>
<ul class="sectlevel3">
<li><a href="_brokers.html#serverless-broker-types-default_serverless-broker-types">4.2.1. Default broker implementation for development purposes</a>
</li>
<li><a href="_brokers.html#serverless-broker-types-production_serverless-broker-types">4.2.2. Production-ready Knative broker implementation for Apache Kafka</a>
</li>
</ul>
</li>
<li><a href="_brokers.html#serverless-using-brokers">4.3. Creating brokers</a>
<ul class="sectlevel3">
<li><a href="_brokers.html#serverless-create-broker-kn_serverless-using-brokers">4.3.1. Creating a broker by using the Knative CLI</a>
</li>
<li><a href="_brokers.html#serverless-creating-broker-annotation_serverless-using-brokers">4.3.2. Creating a broker by annotating a trigger</a>
</li>
<li><a href="_brokers.html#serverless-creating-broker-labeling_serverless-using-brokers">4.3.3. Creating a broker by labeling a namespace</a>
</li>
<li><a href="_brokers.html#serverless-deleting-broker-injection_serverless-using-brokers">4.3.4. Deleting a broker that was created by injection</a>
</li>
<li><a href="_brokers.html#serverless-creating-a-broker-odc_serverless-using-brokers">4.3.5. Creating a broker by using the web console</a>
</li>
<li><a href="_brokers.html#serverless-creating-broker-admin-web-console_serverless-using-brokers">4.3.6. Creating a broker by using the Administrator perspective</a>
</li>
<li><a href="_brokers.html#next-steps_serverless-using-brokers">4.3.7. Next steps</a>
</li>
<li><a href="_brokers.html#additional-resources_serverless-using-brokers">4.3.8. Additional resources</a>
</li>
</ul>
</li>
<li><a href="_brokers.html#serverless-broker-backing-channel-default">4.4. Configuring the default broker backing channel</a>
</li>
<li><a href="_brokers.html#serverless-global-config-broker-class-default">4.5. Configuring the default broker class</a>
</li>
<li><a href="_brokers.html#kafka-broker">4.6. Knative broker implementation for Apache Kafka</a>
<ul class="sectlevel3">
<li><a href="_brokers.html#creating-kafka-broker">4.6.1. Creating an Apache Kafka broker when it is not configured as the default broker type</a>
</li>
<li><a href="_brokers.html#serverless-kafka-broker-configmap_kafka-broker">4.6.2. Configuring Apache Kafka broker settings</a>
</li>
<li><a href="_brokers.html#serverless-kafka-admin-security">4.6.3. Security configuration for the Knative broker implementation for Apache Kafka</a>
</li>
<li><a href="_brokers.html#additional-resources_serverless-kafka-admin">4.6.4. Additional resources</a>
</li>
</ul>
</li>
<li><a href="_brokers.html#serverless-using-brokers-managing-brokers">4.7. Managing brokers</a>
<ul class="sectlevel3">
<li><a href="_brokers.html#serverless-list-broker-kn_serverless-using-brokers-managing-brokers">4.7.1. Listing existing brokers by using the Knative CLI</a>
</li>
<li><a href="_brokers.html#serverless-describe-broker-kn_serverless-using-brokers-managing-brokers">4.7.2. Describing an existing broker by using the Knative CLI</a>
</li>
</ul>
</li>
<li><a href="_brokers.html#serverless-event-delivery">4.8. Event delivery</a>
<ul class="sectlevel3">
<li><a href="_brokers.html#serverless-event-delivery-component-behaviors_serverless-event-delivery">4.8.1. Event delivery behavior patterns for channels and brokers</a>
</li>
<li><a href="_brokers.html#serverless-event-delivery-parameters_serverless-event-delivery">4.8.2. Configurable event delivery parameters</a>
</li>
<li><a href="_brokers.html#serverless-configuring-event-delivery-examples_serverless-event-delivery">4.8.3. Examples of configuring event delivery parameters</a>
</li>
<li><a href="_brokers.html#trigger-event-delivery-config_serverless-event-delivery">4.8.4. Configuring event delivery ordering for triggers</a>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="_triggers.html">5. Triggers</a>
</li>
<li><a href="_channels.html">6. Channels</a>
</li>
<li><a href="_subscriptions.html">7. Subscriptions</a>
</li>
<li><a href="_event-discovery.html">8. Event discovery</a>
</li>
<li><a href="_tuning-eventing-configuration.html">9. Tuning eventing configuration</a>
</li>
<li><a href="kube-rbac-proxy-eventing.html">10. Configuring kube-rbac-proxy for Eventing</a>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_brokers">4. Brokers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="serverless-brokers">4.1. Brokers</h3>
<div class="paragraph">
<p>Brokers can be used in combination with triggers to deliver events from an event source to an event sink. Events are sent from an event source to a broker as an HTTP <code>POST</code> request. After events have entered the broker, they can be filtered by <a href="https://github.com/cloudevents/spec/blob/v1.0/spec.md#context-attributes">CloudEvent attributes</a> using triggers, and sent as an HTTP <code>POST</code> request to an event sink.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/serverless-event-broker-workflow.png" alt="Broker event delivery overview">
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-broker-types">4.2. Broker types</h3>
<div class="paragraph">
<p>Cluster administrators can set the default broker implementation for a cluster. When you create a broker, the default broker implementation is used, unless you provide set configurations in the <code>Broker</code> object.</p>
</div>
<div class="sect3">
<h4 id="serverless-broker-types-default_serverless-broker-types">4.2.1. Default broker implementation for development purposes</h4>
<div class="paragraph">
<p>Knative provides a default, channel-based broker implementation. This channel-based broker can be used for development and testing purposes, but does not provide adequate event delivery guarantees for production environments. The default broker is backed by the <code>InMemoryChannel</code> channel implementation by default.</p>
</div>
<div class="paragraph">
<p>If you want to use Apache Kafka to reduce network hops, use the Knative broker implementation for Apache Kafka. Do not configure the channel-based broker to be backed by the <code>KafkaChannel</code> channel implementation.</p>
</div>
</div>
<div class="sect3">
<h4 id="serverless-broker-types-production_serverless-broker-types">4.2.2. Production-ready Knative broker implementation for Apache Kafka</h4>
<div class="paragraph">
<p>For production-ready Knative Eventing deployments, Red Hat recommends using the Knative broker implementation for Apache Kafka. The broker is an Apache Kafka native implementation of the Knative broker, which sends CloudEvents directly to the Kafka instance.</p>
</div>
<div class="paragraph">
<p>The Knative broker has a native integration with Kafka for storing and routing events. This allows better integration with Kafka for the broker and trigger model over other broker types, and reduces network hops. Other benefits of the Knative broker implementation include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At-least-once delivery guarantees</p>
</li>
<li>
<p>Ordered delivery of events, based on the CloudEvents partitioning extension</p>
</li>
<li>
<p>Control plane high availability</p>
</li>
<li>
<p>A horizontally scalable data plane</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The  Knative broker implementation for Apache Kafka stores incoming CloudEvents as Kafka records, using the binary content mode. This means that all CloudEvent attributes and extensions are mapped as headers on the Kafka record, while the <code>data</code> spec of the CloudEvent corresponds to the value of the Kafka record.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-using-brokers">4.3. Creating brokers</h3>
<div class="paragraph">
<p>Knative provides a default, channel-based broker implementation. This channel-based broker can be used for development and testing purposes, but does not provide adequate event delivery guarantees for production environments.</p>
</div>
<div class="paragraph">
<p>If a cluster administrator has configured your Red Hat OpenShift Serverless deployment to use Apache Kafka as the default broker type, creating a broker by using the default settings creates a Knative broker for Apache Kafka.</p>
</div>
<div class="paragraph">
<p>If your Red Hat OpenShift Serverless deployment is not configured to use the Knative broker for Apache Kafka as the default broker type, the channel-based broker is created when you use the default settings in the following procedures.</p>
</div>
<div class="sect3">
<h4 id="serverless-create-broker-kn_serverless-using-brokers">4.3.1. Creating a broker by using the Knative CLI</h4>
<div class="paragraph">
<p>Brokers can be used in combination with triggers to deliver events from an event source to an event sink. Using the Knative (<code>kn</code>) CLI to create brokers provides a more streamlined and intuitive user interface over modifying YAML files directly. You can use the <code>kn broker create</code> command to create a broker.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in Red Hat OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Create a broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kn broker create &lt;broker_name&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Verification</div>
<ol class="arabic">
<li>
<p>Use the <code>kn</code> command to list all existing brokers:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kn broker list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">NAME      URL                                                                     AGE   CONDITIONS   READY   REASON
default   http://broker-ingress.knative-eventing.svc.cluster.local/test/default   45s   5 OK / 5     True</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: If you are using the Red Hat OpenShift Container Platform web console, you can navigate to the <strong>Topology</strong> view in the <strong>Developer</strong> perspective, and observe that the broker exists:</p>
<div class="imageblock">
<div class="content">
<img src="images/odc-view-broker.png" alt="View the broker in the web console Topology view">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-broker-annotation_serverless-using-brokers">4.3.2. Creating a broker by annotating a trigger</h4>
<div class="paragraph">
<p>Brokers can be used in combination with triggers to deliver events from an event source to an event sink. You can create a broker by adding the <code>eventing.knative.dev/injection: enabled</code> annotation to a <code>Trigger</code> object.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you create a broker by using the <code>eventing.knative.dev/injection: enabled</code> annotation, you cannot delete this broker without cluster administrator permissions.
If you delete the broker without having a cluster administrator remove this annotation first, the broker is created again after deletion.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in Red Hat OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a <code>Trigger</code> object as a YAML file that has the <code>eventing.knative.dev/injection: enabled</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Trigger
metadata:
  annotations:
    eventing.knative.dev/injection: enabled
  name: &lt;trigger_name&gt;
spec:
  broker: default
  subscriber: <b class="conum">(1)</b>
    ref:
      apiVersion: serving.knative.dev/v1
      kind: Service
      name: &lt;service_name&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>Specify details about the event sink, or <em>subscriber</em>, that the trigger sends events to.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the <code>Trigger</code> YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the broker has been created successfully by using the <code>oc</code> CLI, or by observing it in the <strong>Topology</strong> view in the web console.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enter the following <code>oc</code> command to get the broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc -n &lt;namespace&gt; get broker default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">NAME      READY     REASON    URL                                                                     AGE
default   True                http://broker-ingress.knative-eventing.svc.cluster.local/test/default   3m56s</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: If you are using the Red Hat OpenShift Container Platform web console, you can navigate to the <strong>Topology</strong> view in the <strong>Developer</strong> perspective, and observe that the broker exists:</p>
<div class="imageblock">
<div class="content">
<img src="images/odc-view-broker.png" alt="View the broker in the web console Topology view">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-broker-labeling_serverless-using-brokers">4.3.3. Creating a broker by labeling a namespace</h4>
<div class="paragraph">
<p>Brokers can be used in combination with triggers to deliver events from an event source to an event sink. You can create the <code>default</code> broker automatically by labelling a namespace that you own or have write permissions for.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Brokers created using this method are not removed if you remove the label. You must manually delete them.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>You have cluster or dedicated administrator permissions if you are using Red Hat OpenShift Service on AWS or Red Hat OpenShift Dedicated.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Label a namespace with <code>eventing.knative.dev/injection=enabled</code>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc label namespace &lt;namespace&gt; eventing.knative.dev/injection=enabled</code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the broker has been created successfully by using the <code>oc</code> CLI, or by observing it in the <strong>Topology</strong> view in the web console.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the <code>oc</code> command to get the broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc -n &lt;namespace&gt; get broker &lt;broker_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc -n default get broker default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">NAME      READY     REASON    URL                                                                     AGE
default   True                http://broker-ingress.knative-eventing.svc.cluster.local/test/default   3m56s</code></pre>
</div>
</div>
</li>
<li>
<p>Optional: If you are using the Red Hat OpenShift Container Platform web console, you can navigate to the <strong>Topology</strong> view in the <strong>Developer</strong> perspective, and observe that the broker exists:</p>
<div class="imageblock">
<div class="content">
<img src="images/odc-view-broker.png" alt="View the broker in the web console Topology view">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-deleting-broker-injection_serverless-using-brokers">4.3.4. Deleting a broker that was created by injection</h4>
<div class="paragraph">
<p>If you create a broker by injection and later want to delete it, you must delete it manually. Brokers created by using a namespace label or trigger annotation are not deleted permanently if you remove the label or annotation.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Remove the <code>eventing.knative.dev/injection=enabled</code> label from the namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc label namespace &lt;namespace&gt; eventing.knative.dev/injection-</code></pre>
</div>
</div>
<div class="paragraph">
<p>Removing the annotation prevents Knative from recreating the broker after you delete it.</p>
</div>
</li>
<li>
<p>Delete the broker from the selected namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc -n &lt;namespace&gt; delete broker &lt;broker_name&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Verification</div>
<ul>
<li>
<p>Use the <code>oc</code> command to get the broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc -n &lt;namespace&gt; get broker &lt;broker_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc -n default get broker default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">No resources found.
Error from server (NotFound): brokers.eventing.knative.dev "default" not found</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-a-broker-odc_serverless-using-brokers">4.3.5. Creating a broker by using the web console</h4>
<div class="paragraph">
<p>After Knative Eventing is installed on your cluster, you can create a broker by using the web console. Using the Red Hat OpenShift Container Platform web console provides a streamlined and intuitive user interface to create a broker.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have logged in to the Red Hat OpenShift Container Platform web console.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Serving and Knative Eventing are installed on the cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in Red Hat OpenShift Container Platform.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>+Add</strong> &#8594; <strong>Broker</strong>. The <strong>Broker</strong> page is displayed.</p>
</li>
<li>
<p>Optional. Update the <strong>Name</strong> of the broker. If you do not update the name, the generated broker is named <code>default</code>.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Verification</div>
<p>You can verify that the broker was created by viewing broker components in the <strong>Topology</strong> page.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In the <strong>Developer</strong> perspective, navigate to <strong>Topology</strong>.</p>
</li>
<li>
<p>View the <code>mt-broker-ingress</code>, <code>mt-broker-filter</code>, and <code>mt-broker-controller</code> components.</p>
<div class="imageblock">
<div class="content">
<img src="images/serverless-verify-broker-odc.png" alt="View the broker components in the Topology view">
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-creating-broker-admin-web-console_serverless-using-brokers">4.3.6. Creating a broker by using the Administrator perspective</h4>
<div class="paragraph">
<p>Brokers can be used in combination with triggers to deliver events from an event source to an event sink. Events are sent from an event source to a broker as an HTTP <code>POST</code> request. After events have entered the broker, they can be filtered by <a href="https://github.com/cloudevents/spec/blob/v1.0/spec.md#context-attributes">CloudEvent attributes</a> using triggers, and sent as an HTTP <code>POST</code> request to an event sink.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/serverless-event-broker-workflow.png" alt="Broker event delivery overview">
</div>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have logged in to the web console and are in the <strong>Administrator</strong> perspective.</p>
</li>
<li>
<p>You have cluster administrator permissions on Red Hat OpenShift Container Platform, or you have cluster or dedicated administrator permissions on Red Hat OpenShift Service on AWS or Red Hat OpenShift Dedicated.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>In the <strong>Administrator</strong> perspective of the Red Hat OpenShift Container Platform web console, navigate to <strong>Serverless</strong> &#8594; <strong>Eventing</strong>.</p>
</li>
<li>
<p>In the <strong>Create</strong> list, select <strong>Broker</strong>. You will be directed to the <strong>Create Broker</strong> page.</p>
</li>
<li>
<p>Optional: Modify the YAML configuration for the broker.</p>
</li>
<li>
<p>Click <strong>Create</strong>.</p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="next-steps_serverless-using-brokers">4.3.7. Next steps</h4>
<div class="ulist">
<ul>
<li>
<p>Configure event delivery parameters that are applied in cases where an event fails to be delivered to an event sink. See <a href="_brokers.html#serverless-configuring-event-delivery-examples_serverless-event-delivery">Examples of configuring event delivery parameters</a>.</p>
</li>
</ul>
</div>
</div>
<div class="sect3 _additional-resources">
<h4 id="additional-resources_serverless-using-brokers">4.3.8. Additional resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="_brokers.html#serverless-global-config-broker-class-default">Configuring the default broker class</a></p>
</li>
<li>
<p><a href="_triggers.html#serverless-triggers">Triggers</a>
<a href="_event-sources.html#knative-event-sources">Event sources</a></p>
</li>
<li>
<p><a href="_brokers.html#serverless-event-delivery">Event delivery</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-broker-backing-channel-default">4.4. Configuring the default broker backing channel</h3>
<div class="paragraph">
<p>If you are using a channel-based broker, you can set the default backing channel type for the broker to either <code>InMemoryChannel</code> or <code>KafkaChannel</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have administrator permissions on Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift Serverless Operator and Knative Eventing on your cluster.</p>
</li>
<li>
<p>You have installed the OpenShift (<code>oc</code>) CLI.</p>
</li>
<li>
<p>If you want to use Apache Kafka channels as the default backing channel type, you must also install the <code>KnativeKafka</code> CR on your cluster.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Modify the <code>KnativeEventing</code> custom resource (CR) to add configuration details for the <code>config-br-default-channel</code> config map:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeEventing
metadata:
  name: knative-eventing
  namespace: knative-eventing
spec:
  config: <b class="conum">(1)</b>
    config-br-default-channel:
      channel-template-spec: |
        apiVersion: messaging.knative.dev/v1beta1
        kind: KafkaChannel <b class="conum">(2)</b>
        spec:
          numPartitions: 6 <b class="conum">(3)</b>
          replicationFactor: 3 <b class="conum">(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>In <code>spec.config</code>, you can specify the config maps that you want to add modified configurations for.</p>
</li>
<li>
<p>The default backing channel type configuration. In this example, the default channel implementation for the cluster is <code>KafkaChannel</code>.</p>
</li>
<li>
<p>The number of partitions for the Kafka channel that backs the broker.</p>
</li>
<li>
<p>The replication factor for the Kafka channel that backs the broker.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the updated <code>KnativeEventing</code> CR:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="serverless-global-config-broker-class-default">4.5. Configuring the default broker class</h3>
<div class="paragraph">
<p>You can use the <code>config-br-defaults</code> config map to specify default broker class settings for Knative Eventing. You can specify the default broker class for the entire cluster or for one or more namespaces. Currently the <code>MTChannelBasedBroker</code> and <code>Kafka</code> broker types are supported.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have administrator permissions on Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift Serverless Operator and Knative Eventing on your cluster.</p>
</li>
<li>
<p>If you want to use the Knative broker for Apache Kafka as the default broker implementation, you must also install the <code>KnativeKafka</code> CR on your cluster.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Modify the <code>KnativeEventing</code> custom resource to add configuration details for the <code>config-br-defaults</code> config map:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: operator.knative.dev/v1beta1
kind: KnativeEventing
metadata:
  name: knative-eventing
  namespace: knative-eventing
spec:
  defaultBrokerClass: Kafka <b class="conum">(1)</b>
  config: <b class="conum">(2)</b>
    config-br-defaults: <b class="conum">(3)</b>
      default-br-config: |
        clusterDefault: <b class="conum">(4)</b>
          brokerClass: Kafka
          apiVersion: v1
          kind: ConfigMap
          name: kafka-broker-config <b class="conum">(5)</b>
          namespace: knative-eventing <b class="conum">(6)</b>
        namespaceDefaults: <b class="conum">(7)</b>
          my-namespace:
            brokerClass: MTChannelBasedBroker
            apiVersion: v1
            kind: ConfigMap
            name: config-br-default-channel <b class="conum">(8)</b>
            namespace: knative-eventing <b class="conum">(9)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The default broker class for Knative Eventing.</p>
</li>
<li>
<p>In <code>spec.config</code>, you can specify the config maps that you want to add modified configurations for.</p>
</li>
<li>
<p>The <code>config-br-defaults</code> config map specifies the default settings for any broker that does not specify <code>spec.config</code> settings or a broker class.</p>
</li>
<li>
<p>The cluster-wide default broker class configuration. In this example, the default broker class implementation for the cluster is <code>Kafka</code>.</p>
</li>
<li>
<p>The <code>kafka-broker-config</code> config map specifies default settings for the Kafka broker. See "Configuring Knative broker for Apache Kafka settings" in the "Additional resources" section.</p>
</li>
<li>
<p>The namespace where the <code>kafka-broker-config</code> config map exists.</p>
</li>
<li>
<p>The namespace-scoped default broker class configuration. In this example, the default broker class implementation for the <code>my-namespace</code> namespace is <code>MTChannelBasedBroker</code>. You can specify default broker class implementations for multiple namespaces.</p>
</li>
<li>
<p>The <code>config-br-default-channel</code> config map specifies the default backing channel for the broker. See "Configuring the default broker backing channel" in the "Additional resources" section.</p>
</li>
<li>
<p>The namespace where the <code>config-br-default-channel</code> config map exists.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Configuring a namespace-specific default overrides any cluster-wide settings.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="kafka-broker">4.6. Knative broker implementation for Apache Kafka</h3>
<div class="paragraph">
<p>For production-ready Knative Eventing deployments, Red Hat recommends using the Knative broker implementation for Apache Kafka. The broker is an Apache Kafka native implementation of the Knative broker, which sends CloudEvents directly to the Kafka instance.</p>
</div>
<div class="paragraph">
<p>The Knative broker has a native integration with Kafka for storing and routing events. This allows better integration with Kafka for the broker and trigger model over other broker types, and reduces network hops. Other benefits of the Knative broker implementation include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>At-least-once delivery guarantees</p>
</li>
<li>
<p>Ordered delivery of events, based on the CloudEvents partitioning extension</p>
</li>
<li>
<p>Control plane high availability</p>
</li>
<li>
<p>A horizontally scalable data plane</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The  Knative broker implementation for Apache Kafka stores incoming CloudEvents as Kafka records, using the binary content mode. This means that all CloudEvent attributes and extensions are mapped as headers on the Kafka record, while the <code>data</code> spec of the CloudEvent corresponds to the value of the Kafka record.</p>
</div>
<div class="sect3">
<h4 id="creating-kafka-broker">4.6.1. Creating an Apache Kafka broker when it is not configured as the default broker type</h4>
<div class="paragraph">
<p>If your Red Hat OpenShift Serverless deployment is not configured to use Kafka broker as the default broker type, you can use one of the following procedures to create a Kafka-based broker.</p>
</div>
<div class="sect4">
<h5 id="serverless-kafka-broker_kafka-broker">Creating an Apache Kafka broker by using YAML</h5>
<div class="paragraph">
<p>Creating Knative resources by using YAML files uses a declarative API, which enables you to describe applications declaratively and in a reproducible manner. To create a Kafka broker by using YAML, you must create a YAML file that defines a <code>Broker</code> object, then apply it by using the <code>oc apply</code> command.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resource are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a Kafka-based broker as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
  annotations:
    eventing.knative.dev/broker.class: Kafka <b class="conum">(1)</b>
  name: example-kafka-broker
spec:
  config:
    apiVersion: v1
    kind: ConfigMap
    name: kafka-broker-config <b class="conum">(2)</b>
    namespace: knative-eventing</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The broker class. If not specified, brokers use the default class as configured by cluster administrators. To use the Kafka broker, this value must be <code>Kafka</code>.</p>
</li>
<li>
<p>The default config map for Knative brokers for Apache Kafka. This config map is created when the Kafka broker functionality is enabled on the cluster by a cluster administrator.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the Kafka-based broker YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="serverless-kafka-broker-with-kafka-topic_kafka-broker">Creating an Apache Kafka broker that uses an externally managed Kafka topic</h5>
<div class="paragraph">
<p>If you want to use a Kafka broker without allowing it to create its own internal topic, you can use an externally managed Kafka topic instead. To do this, you must create a Kafka <code>Broker</code> object that uses the <code>kafka.eventing.knative.dev/external.topic</code> annotation.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resource are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have access to a Kafka instance such as <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.6/html/amq_streams_on_openshift_overview/kafka-concepts_str#kafka-concepts-key_str">Red Hat AMQ Streams</a>, and have created a Kafka topic.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create a Kafka-based broker as a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
  annotations:
    eventing.knative.dev/broker.class: Kafka <b class="conum">(1)</b>
    kafka.eventing.knative.dev/external.topic: &lt;topic_name&gt; <b class="conum">(2)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The broker class. If not specified, brokers use the default class as configured by cluster administrators. To use the Kafka broker, this value must be <code>Kafka</code>.</p>
</li>
<li>
<p>The name of the Kafka topic that you want to use.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the Kafka-based broker YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="serverless-kafka-broker-with-isolated-dataplane_kafka-broker">Knative Broker implementation for Apache Kafka with isolated data plane</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Knative Broker implementation for Apache Kafka with isolated data plane is a Technology Preview feature only. Technology Preview features
are not supported with Red Hat production service level agreements (SLAs) and
might not be functionally complete. Red Hat does not recommend using them
in production. These features provide early access to upcoming product
features, enabling customers to test functionality and provide feedback during
the development process.</p>
</div>
<div class="paragraph">
<p>For more information about the support scope of Red Hat Technology Preview features, see <a href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The Knative Broker implementation for Apache Kafka has 2 planes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Control plane</dt>
<dd>
<p>Consists of controllers that talk to the Kubernetes API, watch for custom objects, and manage the data plane.</p>
</dd>
<dt class="hdlist1">Data plane</dt>
<dd>
<p>The collection of components that listen for incoming events, talk to Apache Kafka, and send events to the event sinks. The Knative Broker implementation for Apache Kafka data plane is where events flow. The implementation consists of <code>kafka-broker-receiver</code> and <code>kafka-broker-dispatcher</code> deployments.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>When you configure a Broker class of <code>Kafka</code>, the Knative Broker implementation for Apache Kafka uses a shared data plane. This means that the <code>kafka-broker-receiver</code> and <code>kafka-broker-dispatcher</code> deployments in the <code>knative-eventing</code> namespace are used for all Apache Kafka Brokers in the cluster.</p>
</div>
<div class="paragraph">
<p>However, when you configure a Broker class of <code>KafkaNamespaced</code>, the Apache Kafka broker controller creates a new data plane for each namespace where a broker exists. This data plane is used by all <code>KafkaNamespaced</code> brokers in that namespace. This provides isolation between the data planes, so that the <code>kafka-broker-receiver</code> and <code>kafka-broker-dispatcher</code> deployments in the user namespace are only used for the broker in that namespace.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>As a consequence of having separate data planes, this security feature creates more deployments and uses more resources. Unless you have such isolation requirements, use a <strong>regular</strong> Broker with a class of <code>Kafka</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="serverless-create-kafka-namespaced-broker-kafka-broker">Creating a Knative broker for Apache Kafka that uses an isolated data plane</h5>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The Knative Broker implementation for Apache Kafka with isolated data plane is a Technology Preview feature only. Technology Preview features
are not supported with Red Hat production service level agreements (SLAs) and
might not be functionally complete. Red Hat does not recommend using them
in production. These features provide early access to upcoming product
features, enabling customers to test functionality and provide feedback during
the development process.</p>
</div>
<div class="paragraph">
<p>For more information about the support scope of Red Hat Technology Preview features, see <a href="https://access.redhat.com/support/offerings/techpreview/">Technology Preview Features Support Scope</a>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To create a <code>KafkaNamespaced</code> broker, you must set the <code>eventing.knative.dev/broker.class</code> annotation to <code>KafkaNamespaced</code>.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resource are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have access to an Apache Kafka instance, such as <a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.6/html/amq_streams_on_openshift_overview/kafka-concepts_str#kafka-concepts-key_str">Red Hat AMQ Streams</a>, and have created a Kafka topic.</p>
</li>
<li>
<p>You have created a project, or have access to a project, with the appropriate roles and permissions to create applications and other workloads in Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create an Apache Kafka-based broker by using a YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
  annotations:
    eventing.knative.dev/broker.class: KafkaNamespaced <b class="conum">(1)</b>
  name: default
  namespace: my-namespace <b class="conum">(2)</b>
spec:
  config:
    apiVersion: v1
    kind: ConfigMap
    name: my-config <b class="conum">(2)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>To use the Apache Kafka broker with isolated data planes, the broker class value must be <code>KafkaNamespaced</code>.</p>
</li>
<li>
<p>The referenced <code>ConfigMap</code> object <code>my-config</code> must be in the same namespace as the <code>Broker</code> object, in this case <code>my-namespace</code>.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the Apache Kafka-based broker YAML file:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>ConfigMap</code> object in <code>spec.config</code> must be in the same namespace as the <code>Broker</code> object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: my-config
  namespace: my-namespace
data:
  ...</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the creation of the first <code>Broker</code> object with the <code>KafkaNamespaced</code> class, the <code>kafka-broker-receiver</code> and <code>kafka-broker-dispatcher</code> deployments are created in the namespace. Subsequently, all brokers with the <code>KafkaNamespaced</code> class in the same namespace will use the same data plane. If no brokers with the <code>KafkaNamespaced</code> class exist in the namespace, the data plane in the namespace is deleted.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-kafka-broker-configmap_kafka-broker">4.6.2. Configuring Apache Kafka broker settings</h4>
<div class="paragraph">
<p>You can configure the replication factor, bootstrap servers, and the number of topic partitions for a Kafka broker, by creating a config map and referencing this config map in the Kafka <code>Broker</code> object.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster or dedicated administrator permissions on Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> custom resource (CR) are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project that has the appropriate roles and permissions to create applications and other workloads in Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Modify the <code>kafka-broker-config</code> config map, or create your own config map that contains the following configuration:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: &lt;config_map_name&gt; <b class="conum">(1)</b>
  namespace: &lt;namespace&gt; <b class="conum">(2)</b>
data:
  default.topic.partitions: &lt;integer&gt; <b class="conum">(3)</b>
  default.topic.replication.factor: &lt;integer&gt; <b class="conum">(4)</b>
  bootstrap.servers: &lt;list_of_servers&gt; <b class="conum">(5)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The config map name.</p>
</li>
<li>
<p>The namespace where the config map exists.</p>
</li>
<li>
<p>The number of topic partitions for the Kafka broker. This controls how quickly events can be sent to the broker. A higher number of partitions requires greater compute resources.</p>
</li>
<li>
<p>The replication factor of topic messages. This prevents against data loss. A higher replication factor requires greater compute resources and more storage.</p>
</li>
<li>
<p>A comma separated list of bootstrap servers. This can be inside or outside of the Red Hat OpenShift Container Platform cluster, and is a list of Kafka clusters that the broker receives events from and sends events to.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>The <code>default.topic.replication.factor</code> value must be less than or equal to the number of Kafka broker instances in your cluster. For example, if you only have one Kafka broker, the <code>default.topic.replication.factor</code> value should not be more than <code>"1"</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Example Kafka broker config map</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: ConfigMap
metadata:
  name: kafka-broker-config
  namespace: knative-eventing
data:
  default.topic.partitions: "10"
  default.topic.replication.factor: "3"
  bootstrap.servers: "my-cluster-kafka-bootstrap.kafka:9092"</code></pre>
</div>
</div>
</li>
<li>
<p>Apply the config map:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ oc apply -f &lt;config_map_filename&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>Specify the config map for the Kafka <code>Broker</code> object:</p>
<div class="listingblock">
<div class="title">Example Broker object</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
  name: &lt;broker_name&gt; <b class="conum">(1)</b>
  namespace: &lt;namespace&gt; <b class="conum">(2)</b>
  annotations:
    eventing.knative.dev/broker.class: Kafka <b class="conum">(3)</b>
spec:
  config:
    apiVersion: v1
    kind: ConfigMap
    name: &lt;config_map_name&gt; <b class="conum">(4)</b>
    namespace: &lt;namespace&gt; <b class="conum">(5)</b>
...</code></pre>
</div>
</div>
<div class="colist arabic">
<ol>
<li>
<p>The broker name.</p>
</li>
<li>
<p>The namespace where the broker exists.</p>
</li>
<li>
<p>The broker class annotation. In this example, the broker is a Kafka broker that uses the class value <code>Kafka</code>.</p>
</li>
<li>
<p>The config map name.</p>
</li>
<li>
<p>The namespace where the config map exists.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Apply the broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">$ oc apply -f &lt;broker_filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="serverless-kafka-admin-security">4.6.3. Security configuration for the Knative broker implementation for Apache Kafka</h4>
<div class="paragraph">
<p>Kafka clusters are generally secured by using the TLS or SASL authentication methods. You can configure a Kafka broker or channel to work against a protected Red Hat AMQ Streams cluster by using TLS or SASL.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Red Hat recommends that you enable both SASL and TLS together.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="serverless-kafka-broker-tls-default-config_kafka-broker">Configuring TLS authentication for Apache Kafka brokers</h5>
<div class="paragraph">
<p><em>Transport Layer Security</em> (TLS) is used by Apache Kafka clients and servers to encrypt traffic between Knative and Kafka, as well as for authentication. TLS is the only supported method of traffic encryption for the Knative broker implementation for Apache Kafka.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster or dedicated administrator permissions on Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> CR are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>You have a Kafka cluster CA certificate stored as a <code>.pem</code> file.</p>
</li>
<li>
<p>You have a Kafka cluster client certificate and a key stored as <code>.pem</code> files.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the certificate files as a secret in the <code>knative-eventing</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc create secret -n knative-eventing generic &lt;secret_name&gt; \
  --from-literal=protocol=SSL \
  --from-file=ca.crt=caroot.pem \
  --from-file=user.crt=certificate.pem \
  --from-file=user.key=key.pem</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="paragraph">
<p>Use the key names <code>ca.crt</code>, <code>user.crt</code>, and <code>user.key</code>. Do not change them.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Edit the <code>KnativeKafka</code> CR and add a reference to your secret in the <code>broker</code> spec:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: operator.serverless.openshift.io/v1alpha1
kind: KnativeKafka
metadata:
  namespace: knative-eventing
  name: knative-kafka
spec:
  broker:
    enabled: true
    defaultConfig:
      authSecretName: &lt;secret_name&gt;
...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="serverless-kafka-broker-sasl-default-config_kafka-broker">Configuring SASL authentication for Apache Kafka brokers</h5>
<div class="paragraph">
<p><em>Simple Authentication and Security Layer</em> (SASL) is used by Apache Kafka for authentication. If you use SASL authentication on your cluster, users must provide credentials to Knative for communicating with the Kafka cluster; otherwise events cannot be produced or consumed.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>You have cluster or dedicated administrator permissions on Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and the <code>KnativeKafka</code> CR are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>You have a username and password for a Kafka cluster.</p>
</li>
<li>
<p>You have chosen the SASL mechanism to use, for example, <code>PLAIN</code>, <code>SCRAM-SHA-256</code>, or <code>SCRAM-SHA-512</code>.</p>
</li>
<li>
<p>If TLS is enabled, you also need the <code>ca.crt</code> certificate file for the Kafka cluster.</p>
</li>
<li>
<p>Install the OpenShift CLI (<code>oc</code>).</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create the certificate files as a secret in the <code>knative-eventing</code> namespace:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc create secret -n knative-eventing generic &lt;secret_name&gt; \
  --from-literal=protocol=SASL_SSL \
  --from-literal=sasl.mechanism=&lt;sasl_mechanism&gt; \
  --from-file=ca.crt=caroot.pem \
  --from-literal=password="SecretPassword" \
  --from-literal=user="my-sasl-user"</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Use the key names <code>ca.crt</code>, <code>password</code>, and <code>sasl.mechanism</code>. Do not change them.</p>
</li>
<li>
<p>If you want to use SASL with public CA certificates, you must use the <code>tls.enabled=true</code> flag, rather than the <code>ca.crt</code> argument, when creating the secret. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc create secret -n &lt;namespace&gt; generic &lt;kafka_auth_secret&gt; \
  --from-literal=tls.enabled=true \
  --from-literal=password="SecretPassword" \
  --from-literal=saslType="SCRAM-SHA-512" \
  --from-literal=user="my-sasl-user"</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Edit the <code>KnativeKafka</code> CR and add a reference to your secret in the <code>broker</code> spec:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: operator.serverless.openshift.io/v1alpha1
kind: KnativeKafka
metadata:
  namespace: knative-eventing
  name: knative-kafka
spec:
  broker:
    enabled: true
    defaultConfig:
      authSecretName: &lt;secret_name&gt;
...</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3 _additional-resources">
<h4 id="additional-resources_serverless-kafka-admin">4.6.4. Additional resources</h4>
<div class="ulist">
<ul>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.6/html/amq_streams_on_openshift_overview/kafka-concepts_str#kafka-concepts-key_str">Red Hat AMQ Streams documentation</a></p>
</li>
<li>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_amq/7.5/html-single/using_amq_streams_on_rhel/index#assembly-kafka-encryption-and-authentication-str">TLS and SASL on Kafka</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-using-brokers-managing-brokers">4.7. Managing brokers</h3>
<div class="paragraph">
<p>The Knative (<code>kn</code>) CLI provides commands that can be used to describe and list existing brokers.</p>
</div>
<div class="sect3">
<h4 id="serverless-list-broker-kn_serverless-using-brokers-managing-brokers">4.7.1. Listing existing brokers by using the Knative CLI</h4>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to list brokers provides a streamlined and intuitive user interface. You can use the <code>kn broker list</code> command to list existing brokers in your cluster by using the Knative CLI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>List all existing brokers:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kn broker list</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">NAME      URL                                                                     AGE   CONDITIONS   READY   REASON
default   http://broker-ingress.knative-eventing.svc.cluster.local/test/default   45s   5 OK / 5     True</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="serverless-describe-broker-kn_serverless-using-brokers-managing-brokers">4.7.2. Describing an existing broker by using the Knative CLI</h4>
<div class="paragraph">
<p>Using the Knative (<code>kn</code>) CLI to describe brokers provides a streamlined and intuitive user interface. You can use the <code>kn broker describe</code> command to print information about existing brokers in your cluster by using the Knative CLI.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator and Knative Eventing are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>You have installed the Knative (<code>kn</code>) CLI.</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">Procedure</div>
<ul>
<li>
<p>Describe an existing broker:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kn broker describe &lt;broker_name&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example command using default broker</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ kn broker describe default</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">Name:         default
Namespace:    default
Annotations:  eventing.knative.dev/broker.class=MTChannelBasedBroker, eventing.knative.dev/creato ...
Age:          22s

Address:
  URL:    http://broker-ingress.knative-eventing.svc.cluster.local/default/default

Conditions:
  OK TYPE                   AGE REASON
  ++ Ready                  22s
  ++ Addressable            22s
  ++ FilterReady            22s
  ++ IngressReady           22s
  ++ TriggerChannelReady    22s</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="serverless-event-delivery">4.8. Event delivery</h3>
<div class="paragraph">
<p>You can configure event delivery parameters that are applied in cases where an event fails to be delivered to an event sink. Configuring event delivery parameters, including a dead letter sink, ensures that any events that fail to be delivered to an event sink are retried. Otherwise, undelivered events are dropped.</p>
</div>
<div class="sect3">
<h4 id="serverless-event-delivery-component-behaviors_serverless-event-delivery">4.8.1. Event delivery behavior patterns for channels and brokers</h4>
<div class="paragraph">
<p>Different channel and broker types have their own behavior patterns that are followed for event delivery.</p>
</div>
<div class="sect4">
<h5 id="serverless-event-delivery-component-behaviors-kafka_serverless-event-delivery">Knative channels and brokers for Apache Kafka</h5>
<div class="paragraph">
<p>If an event is successfully delivered to a Kafka channel or broker receiver, the receiver responds with a <code>202</code> status code, which means that the event has been safely stored inside a Kafka topic and is not lost.</p>
</div>
<div class="paragraph">
<p>If the receiver responds with any other status code, the event is not safely stored, and steps must be taken by the user to resolve the issue.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="serverless-event-delivery-parameters_serverless-event-delivery">4.8.2. Configurable event delivery parameters</h4>
<div class="paragraph">
<p>The following parameters can be configured for event delivery:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Dead letter sink</dt>
<dd>
<p>You can configure the <code>deadLetterSink</code> delivery parameter so that if an event fails to be delivered, it is stored in the specified event sink. Undelivered events that are not stored in a dead letter sink are dropped. The dead letter sink be any addressable object that conforms to the Knative Eventing sink contract, such as a Knative service, a Kubernetes service, or a URI.</p>
</dd>
<dt class="hdlist1">Retries</dt>
<dd>
<p>You can set a minimum number of times that the delivery must be retried before the event is sent to the dead letter sink, by configuring the <code>retry</code> delivery parameter with an integer value.</p>
</dd>
<dt class="hdlist1">Back off delay</dt>
<dd>
<p>You can set the <code>backoffDelay</code> delivery parameter to specify the time delay before an event delivery retry is attempted after a failure. The duration of the <code>backoffDelay</code> parameter is specified using the <a href="https://en.wikipedia.org/wiki/ISO_8601#Durations">ISO 8601</a> format. For example, <code>PT1S</code> specifies a 1 second delay.</p>
</dd>
<dt class="hdlist1">Back off policy</dt>
<dd>
<p>The <code>backoffPolicy</code> delivery parameter can be used to specify the retry back off policy. The policy can be specified as either <code>linear</code> or <code>exponential</code>. When using the <code>linear</code> back off policy, the back off delay is equal to <code>backoffDelay * &lt;numberOfRetries&gt;</code>. When using the <code>exponential</code> backoff policy, the back off delay is equal to <code>backoffDelay*2^&lt;numberOfRetries&gt;</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="serverless-configuring-event-delivery-examples_serverless-event-delivery">4.8.3. Examples of configuring event delivery parameters</h4>
<div class="paragraph">
<p>You can configure event delivery parameters for <code>Broker</code>, <code>Trigger</code>, <code>Channel</code>, and <code>Subscription</code> objects. If you configure event delivery parameters for a broker or channel, these parameters are propagated to triggers or subscriptions created for those objects. You can also set event delivery parameters for triggers or subscriptions to override the settings for the broker or channel.</p>
</div>
<div class="listingblock">
<div class="title">Example <code>Broker</code> object</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Broker
metadata:
...
spec:
  delivery:
    deadLetterSink:
      ref:
        apiVersion: eventing.knative.dev/v1alpha1
        kind: KafkaSink
        name: &lt;sink_name&gt;
    backoffDelay: &lt;duration&gt;
    backoffPolicy: &lt;policy_type&gt;
    retry: &lt;integer&gt;
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>Trigger</code> object</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Trigger
metadata:
...
spec:
  broker: &lt;broker_name&gt;
  delivery:
    deadLetterSink:
      ref:
        apiVersion: serving.knative.dev/v1
        kind: Service
        name: &lt;sink_name&gt;
    backoffDelay: &lt;duration&gt;
    backoffPolicy: &lt;policy_type&gt;
    retry: &lt;integer&gt;
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>Channel</code> object</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: messaging.knative.dev/v1
kind: Channel
metadata:
...
spec:
  delivery:
    deadLetterSink:
      ref:
        apiVersion: serving.knative.dev/v1
        kind: Service
        name: &lt;sink_name&gt;
    backoffDelay: &lt;duration&gt;
    backoffPolicy: &lt;policy_type&gt;
    retry: &lt;integer&gt;
...</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example <code>Subscription</code> object</div>
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: messaging.knative.dev/v1
kind: Subscription
metadata:
...
spec:
  channel:
    apiVersion: messaging.knative.dev/v1
    kind: Channel
    name: &lt;channel_name&gt;
  delivery:
    deadLetterSink:
      ref:
        apiVersion: serving.knative.dev/v1
        kind: Service
        name: &lt;sink_name&gt;
    backoffDelay: &lt;duration&gt;
    backoffPolicy: &lt;policy_type&gt;
    retry: &lt;integer&gt;
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="trigger-event-delivery-config_serverless-event-delivery">4.8.4. Configuring event delivery ordering for triggers</h4>
<div class="paragraph">
<p>If you are using a Kafka broker, you can configure the delivery order of events from triggers to event sinks.</p>
</div>
<div class="ulist">
<div class="title">Prerequisites</div>
<ul>
<li>
<p>The OpenShift Serverless Operator, Knative Eventing, and Knative Kafka are installed on your Red Hat OpenShift Container Platform cluster.</p>
</li>
<li>
<p>Kafka broker is enabled for use on your cluster, and you have created a Kafka broker.</p>
</li>
<li>
<p>You have created a project or have access to a project with the appropriate roles and permissions to create applications and other workloads in Red Hat OpenShift Container Platform.</p>
</li>
<li>
<p>You have installed the OpenShift (<code>oc</code>) CLI.</p>
</li>
</ul>
</div>
<div class="olist arabic">
<div class="title">Procedure</div>
<ol class="arabic">
<li>
<p>Create or modify a <code>Trigger</code> object and set the <code>kafka.eventing.knative.dev/delivery.order</code> annotation:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: eventing.knative.dev/v1
kind: Trigger
metadata:
  name: &lt;trigger_name&gt;
  annotations:
     kafka.eventing.knative.dev/delivery.order: ordered
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>The supported consumer delivery guarantees are:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>unordered</code></dt>
<dd>
<p>An unordered consumer is a non-blocking consumer that delivers messages unordered, while preserving proper offset management.</p>
</dd>
<dt class="hdlist1"><code>ordered</code></dt>
<dd>
<p>An ordered consumer is a per-partition blocking consumer that waits for a successful response from the CloudEvent subscriber before it delivers the next message of the partition.</p>
<div class="paragraph">
<p>The default ordering guarantee is <code>unordered</code>.</p>
</div>
</dd>
</dl>
</div>
</li>
<li>
<p>Apply the <code>Trigger</code> object:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terminal" data-lang="terminal">$ oc apply -f &lt;filename&gt;</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
</div>
</div>
<div class="paragraph nav-footer">
<p>← Previous: <a href="_event-sinks.html">Event sinks</a> | ↑ Up: <a href="master.html">Eventing</a> | Next: <a href="_triggers.html">Triggers</a> →</p>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2023-09-08 11:21:11 -0600
</div>
</div>
<script type = "application/ld+json" >
        {
            "@context": "http://schema.org",
            "@type": "Book",
            "genre": "technical",
            "schemaVersion": "https://schema.org/docs/releases.html#v10.0",
            "license": "http://creativecommons.org/licenses/by-sa/3.0/",
            "about": "Red Hat OpenShift Serverless 1.2.9 Red Hat OpenShift Container Platform 4.13 OSS",
            "@id": "Red Hat OpenShift Serverless 1.2.9",
            "archivedAt": "docs.redhat.com",
            "audience": "",
            "conditionsOfAccess": "",
            "isAccessibleForFree": "true",
            "isBasedOn": "Red Hat OpenShift Container Platform 4.13",
            "isPartOf": "Eventing",
            "educationLevel": "Basic",
            "name": "Red Hat OpenShift Serverless",
            "headline": "Brokers",
            "mainEntity": "Red Hat OpenShift Serverless 1.2.9",
            "version": "1.2.9",
            "alternateName": "OSS",
            "author": {
                "@type": "Organization",
                "name": "Red Hat Customer Content Services"
            },
            "maintainer": {
                "@type": "Organization",
                "name": "Red Hat Customer Content Services"
            },
            "copyrightHolder": {
                "@type": "Organization",
                "name": "Red Hat, Inc."
            },
            "publisher": {
                "@type": "Organization",
                "name": "Red Hat, Inc."
            },
            "sourceOrganization": "Red Hat, Inc.",
            "dateModified": "2023-09-08 20:07:37 UTC",
            "copyrightYear": "2023",
            "abstract": "",
            "keywords": "Serverless, Cloud"
        }
    </script>
</body>
</html>